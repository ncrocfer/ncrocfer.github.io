<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ncrocfer, Python & Web security">

    
    <title>Autoreload des modules sous iPython // ncrocfer // Python & Web security</title>
    

    

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.3.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://ncrocfer.github.io/css/pure.css">
    <link rel="stylesheet" href="https://ncrocfer.github.io/css/pygments.css">
    

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    
<script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.0.1/jquery.fitvids.min.js"></script>
<script>
        $(document).ready(function(){
            $(".content").fitVids();
        });
    </script>

</head>

<body>

<div class="pure-g-r" id="layout">
    <div class="sidebar pure-u">
    <div class="cover-img" style="background-color: #0D302E;">
        <div class="cover-body">
            <header class="header">
                <hgroup>
                    <h1 class="brand-main"><a href="/">ncrocfer</a></h1>
                    <p class="tagline">Python & Web security</p>
                    
                    
                    <p class="links"><a href="https://ncrocfer.github.io/a-propos">A propos</a></p>
                    
                    
                    <p class="social">
                        
                        <a href="https://twitter.com/ncrocfer">
                            <i class="fa fa-twitter-square fa-3x"></i>
                        </a>
                        
                        <a href="https://github.com/ncrocfer">
                            <i class="fa fa-github fa-3x"></i>
                        </a>
                        
                    <p>
                </hgroup>
            </header>
        </div>
    </div>
</div>
    <div class="pure-u">
        <div class="content">
            <section class="post">
                <header class="post-header">
                    <h1>Autoreload des modules sous iPython</h1>
                    
                        <p class="post-meta">
                            
                                category:
                            
                            
                                <a href="https://ncrocfer.github.io/categories/howtos">Howtos</a> 
                            , date: Mon 30 November 2015
                        </p>
                    
                    
                        <p class="post-meta">
                            
                                tags =
                            
                            
                                <a class="post-category" href="https://ncrocfer.github.io/tags/python">python</a>
                            
                                <a class="post-category" href="https://ncrocfer.github.io/tags/ipython">ipython</a>
                            
                        </p>
                    
                </header>
            </section>
            <div class="document">
<p>Si vous utilisez iPython comme interpréteur Python (et si ce n'est pas le cas vous loupez quelque chose), il vous est certainement déjà arrivé de bosser dessus dans un terminal, dans un autre de modifier l'un des modules importés, puis de relancer la fonction dans iPython. Sauf que ce dernier n'a pas rechargé le code et que le résultat est le même qu'avant.</p>

<p>Prenez par exemple le code suivant :</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">calcul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span>
</pre></div>
<p>Bon ok c'est bidon, mais c'est pour montrer le principe. Dans un autre terminal, démarrez iPython puis testez-le :</p>
<div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">calcul</span> <span class="kn">import</span> <span class="n">calcul</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">calcul</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="mi">5</span>
</pre></div>
<p>Si vous modifiez la fonction dans le second terminal, par exemple :</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">calcul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>
</pre></div>
<p>La mise à jour ne sera pas répercutée dans iPython, il faudrait le fermer puis le relancer. L'activation de l'<strong>autoreload</strong> permet d'éviter cela :</p>
<div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">calcul</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="mi">5</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="o">%</span><span class="n">load_ext</span> <span class="n">autoreload</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="o">%</span><span class="n">autoreload</span> <span class="mi">2</span>

<span class="c"># ré-enregistrez le module calcul.py</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">calcul</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="mi">6</span>
</pre></div>
<p>Comme vous le voyez les modifications effectuées après l'activation de l'extension sont automatiquement pris en compte. Si vous souhaitez que l'extension soit activée à chaque session, il faut créer un nouveau profile :</p>
<div class="highlight"><pre>ncrocfer@home:~/ ipython profile create
<span class="o">[</span>ProfileCreate<span class="o">]</span> Generating default config file: <span class="s1">&#39;/home/ncrocfer/.ipython/profile_default/ipython_config.py&#39;</span>
</pre></div>
<p>Puis ajoutez à la fin les lignes suivantes :</p>
<div class="highlight"><pre>c.InteractiveShellApp.exec_lines <span class="o">=</span> <span class="o">[]</span>
c.InteractiveShellApp.exec_lines.append<span class="o">(</span><span class="s1">&#39;%load_ext autoreload&#39;</span><span class="o">)</span>
c.InteractiveShellApp.exec_lines.append<span class="o">(</span><span class="s1">&#39;%autoreload 2&#39;</span><span class="o">)</span>
</pre></div>
<p>L'autoreload des modules importés s'effectuera désormais automatiquement !</p>
</div>


            <a href="https://twitter.com/share" class="twitter-share-button" data-url="https://ncrocfer.github.io/2015/11/30/autoreload-des-modules-sous-ipython" data-text="Autoreload des modules sous iPython" data-via="ncrocfer">Tweet</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

            <div class="hr"></div>
            <a href="#" class="go-top">Go Top</a>
            <footer class="footer">
    <p>&copy; ncrocfer &ndash;
        Built with <a href="https://github.com/ncrocfer/radric">Radric</a>
        and a modified version of <a href="https://github.com/PurePelicanTheme/pure">Pure Theme</a>
    </p>
</footer>
        </div>
    </div>
</div>

<script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65778407-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>